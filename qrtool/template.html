<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>QR Tool | Laddge Toolbox</title>
</head>
<body>
    <h1>QR Tool</h1>
    <div style="width: 100vw; margin-left: auto;">
    <form method="POST" enctype="multipart/form-data">
    <textarea name="string" style="width: 80%;">{{ string }}</textarea>
    <input type="hidden" name="b64" id="b64" value="{{ b64 }}">
    <br>
    <button type="submit">Submit</button>
    </form>
    <input type="file" accept="image/*" onchange="previewImage(this);">
    <img id="show" src="data:image/png;base64,{{ b64 }}" style="width: 80%;" alt="image">
    {{ dl_btn }}
    </div>
    <script type="text/javascript">
        function previewImage(obj)
        {
            var fileReader = new FileReader();
            fileReader.onload = (function() {
                document.getElementById('show').src = fileReader.result;
                document.getElementById('b64').value = fileReader.result.split(',')[1];
            });
            fileReader.readAsDataURL(obj.files[0]);
        }

        function dl() {
            let b64 = document.getElementById('b64').value
            let blob;
            let bin = atob(b64.replace(/^.\*,/, ""));
            let buffer = new Uint8Array(bin.length);
            for (let i = 0; i < bin.length; i++) {
                buffer[i] = bin.charCodeAt(i);
            }
            try {
                blob = new Blob([buffer.buffer], {
                type: "image/png"
                });
            } catch (e) {
                return false;
            }
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            document.body.appendChild(a);
            a.download = 'download.png';
            a.href = url;
            a.click();
            a.remove();
        }
    </script>
</body>
</html>
